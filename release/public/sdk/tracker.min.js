!function(){"use strict";const e={apiUrl:window.VISIT_TRACKER_API||"http://localhost/api/track",apiKey:window.VISIT_TRACKER_KEY||"",debug:window.VISIT_TRACKER_DEBUG||!1},t={generateId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},getVisitorId:function(){let e=localStorage.getItem("vt_visitor_id");return e||(e=this.generateId(),localStorage.setItem("vt_visitor_id",e)),e},getSessionId:function(){let e=sessionStorage.getItem("vt_session_id");return e||(e=this.generateId(),sessionStorage.setItem("vt_session_id",e)),e},getUrlParams:function(){const e=new URLSearchParams(window.location.search);return{utmSource:e.get("utm_source"),utmMedium:e.get("utm_medium"),utmCampaign:e.get("utm_campaign"),utmTerm:e.get("utm_term"),utmContent:e.get("utm_content")}},getScreenResolution:function(){return screen.width+"x"+screen.height},getTimezone:function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return""}},sendData:function(t){if(e.debug&&console.log("Visit Tracker:",t),navigator.sendBeacon){const e=new Blob([JSON.stringify(t)],{type:"application/json"});navigator.sendBeacon(e.apiUrl,e)}else fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0}).catch((function(t){e.debug&&console.error("Visit Tracker Error:",t)}))}},n={init:function(n,i){if(!n)return void console.error("Visit Tracker: API key is required");e.apiKey=n,i&&(i.apiUrl&&(e.apiUrl=i.apiUrl),i.debug&&(e.debug=i.debug)),this.startTime=Date.now(),this.visitId=null,this.trackPageView(),this.bindEvents()},trackPageView:function(){const n=t.getUrlParams(),i={apiKey:e.apiKey,url:window.location.href,title:document.title,referrer:document.referrer,visitorId:t.getVisitorId(),sessionId:t.getSessionId(),userAgent:navigator.userAgent,language:navigator.language||navigator.userLanguage,timezone:t.getTimezone(),screenResolution:t.getScreenResolution(),duration:0,utmSource:n.utmSource,utmMedium:n.utmMedium,utmCampaign:n.utmCampaign,utmTerm:n.utmTerm,utmContent:n.utmContent};t.sendData(i)},updateDuration:function(){if(!this.visitId||!this.startTime)return;const t=Math.round((Date.now()-this.startTime)/1e3),n={visitId:this.visitId,duration:t};if(navigator.sendBeacon){const t=new Blob([JSON.stringify(n)],{type:"application/json"});navigator.sendBeacon(e.apiUrl+"/duration/"+this.visitId,t)}},bindEvents:function(){const e=this;window.addEventListener("beforeunload",(function(){e.updateDuration()})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.updateDuration()})),setInterval((function(){e.updateDuration()}),3e4)},track:function(n,i){const r={apiKey:e.apiKey,event:n,properties:i||{},url:window.location.href,visitorId:t.getVisitorId(),sessionId:t.getSessionId(),timestamp:Date.now()};t.sendData(r)}};window.VISIT_TRACKER_KEY&&n.init(window.VISIT_TRACKER_KEY,{apiUrl:window.VISIT_TRACKER_API,debug:window.VISIT_TRACKER_DEBUG}),window.VisitTracker=n}();
